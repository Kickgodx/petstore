.common_report:
  image: # image с установленным npm, например node:14.17.0-alpine
  stage: report
  variables:
    REPORT_PATH: "https://ЗАПОЛНИТЬ_ХОСТОМ_ГИТЛАБА/-/autotests/${CI_PROJECT_NAME}/-/jobs/${CI_JOB_ID}/artifacts/allure-report/index.html"
  artifacts:
    name: "Allure-report"
    when: always
    expire_in: 7 days
    paths:
      - ./allure-report
    reports:
      dotenv: report_path.env
  before_script:
    - npm install allure-commandline
    - npm install
  script:
    - npx allure generate --clean -o allure-report
    - echo REPORT_LINK=$REPORT_PATH >> report_path.env
  after_script:
    - echo $REPORT_PATH
    - echo $LOG_PATH
    - echo "REPORT_JOB_STATUS=${CI_JOB_STATUS}" >> report_path.env
  extends:
    - .linux-docker-runners

make_allure_report:
  rules:
    - if: $CI_COMMIT_BRANCH == "master" && $CI_PIPELINE_SOURCE == "schedule" && $SCHEDULED_ALL == "TRUE"
      when: on_success
    - if: $CI_COMMIT_BRANCH == "dev" && $CI_PIPELINE_SOURCE == "schedule" && $SCHEDULED_ALL == "TRUE"
      when: on_success
    - when: manual
  needs:
    - run_tests
  extends:
    - .common_report